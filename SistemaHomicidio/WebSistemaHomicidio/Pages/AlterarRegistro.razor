@page "/SIMIP/alterar-registro/{id:int}"
@attribute [Authorize]

<EditForm Model="@editarRegistro" OnValidSubmit="EditarRegistro" class="editForm">
    <DataAnnotationsValidator />
    <MudContainer Class="mt-16 px-8" MaxWidth="MaxWidth.False">
        <MudGrid>
            <!--Cabeçalho do Formulário-->
            <MudItem xs="12">
                <MudPaper Class="sombra pa-5 mx-2" Elevation="3">
                    <MudGrid>
                        <!-- Nº BOE-->
                        <MudItem xs="12" sm="6" md="2">
                            <MudTextField @bind-Value="@editarRegistro.BOE"
                                          Label="Nº BOE"
                                          Variant="Variant.Outlined"
                                          For="@(()=> editarRegistro.BOE)"
                                          id="boe-mask"/>
                        </MudItem>
                        <!-- Data Registro-->
                        <MudItem xs="12" sm="6" md="2">
                            <MudDatePicker Label="Data Registro"
                                           DisableToolbar="true"
                                           DateFormat="dd/MM/yyyy"
                                           AllowKeyboardInput="true"
                                           MaxDate="DateTime.Now"
                                           @bind-Date="@editarRegistro.DataRegistroBOE"
                                           For="@(()=> editarRegistro.DataRegistroBOE)" />
                        </MudItem>
                        <!-- Tipo de Registro-->
                        <MudItem xs="12" sm="6" md="4">
                            <MudField Label="Tipo de Registro" Variant="Variant.Outlined" InnerPadding="false" Class="align-content-center">
                                <MudRadioGroup @bind-SelectedOption="@editarRegistro.TipoDeRegistro">
                                    <MudRadio Option="@("TENTATIVA")" Color="Color.Primary">Tentativa</MudRadio>
                                    <MudRadio Option="@("CONSUMADO")" Color="Color.Primary">Consumado</MudRadio>
                                    <ValidationMessage For="@(()=> editarRegistro.TipoDeRegistro)" />
                                </MudRadioGroup>
                            </MudField>
                        </MudItem>
                        <!-- Intencionalidade-->
                        <MudItem xs="12" sm="6" md="3">
                            <MudSelect T="string" Label="Intencionalidade" Variant="Variant.Outlined" @bind-Value="editarRegistro.Intencionalidade">
                                <MudSelectItem Value="@("CULPOSO")" />
                                <MudSelectItem Value="@("DOLOSO")" />
                                <MudSelectItem Value="@("DOLO EVENTUAL")" />
                                <MudSelectItem Value="@("NAO INFORMADO")" />
                            </MudSelect>
                            <ValidationMessage For="@(()=> editarRegistro.Intencionalidade)" />
                        </MudItem>
                        <!--Status do Registro-->
                        <MudItem xs="12" sm="6" md="1">
                            <MudGrid Justify="Justify.Center" Style="margin-top: 8px;">
                                <MudText Typo="Typo.caption">Status</MudText>
                                <MudSwitch @bind-Checked="editarRegistro.StatusRegistro" Color="Color.Primary" Class="status"/>
                            </MudGrid>
                        </MudItem>
                        <!--BOEComplementado-->
                        <MudItem xs="12" sm="6">
                            <MudPaper Class="pa-2 mx-2" Elevation="0">
                                <MudTable Items="@listaBOEComplementados" Dense="true" Hover="true" Striped="true" Class="tabelaBOEcomplementado">
                                    <ToolBarContent>
                                        <MudText Typo="Typo.subtitle2">BOE Complementados</MudText>
                                        <MudSpacer />
                                        <MudTooltip Text="Adicionar" Arrow="true" Placement="Placement.Left">
                                            <MudFab @onclick="AdicionarBOEComplementado" Color="Color.Primary" Icon="@Icons.Material.Filled.Add" Size="Size.Small" IconSize="Size.Medium" Class="ma-2" />
                                        </MudTooltip>
                                    </ToolBarContent>
                                    <HeaderContent>
                                        <MudTh>Nº BOE</MudTh>
                                        <MudTh>Data Registro</MudTh>
                                        <MudTh>Ações</MudTh>
                                    </HeaderContent>
                                    <RowTemplate Context="BOEComplementado">
                                        <MudTd DataLabel="Nº BOE">@BOEComplementado.Boe</MudTd>
                                        <MudTd DataLabel="Data Registro">@BOEComplementado.DataRegistro.Value.ToString("d")</MudTd>
                                        <MudTd DataLabel="Ações">
                                            <MudTooltip Text="Alterar" Arrow="true" Placement="Placement.Left">
                                                <MudIconButton @onclick="(()=> EditarBOEComplementado(BOEComplementado))" Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" />
                                            </MudTooltip>
                                            <MudTooltip Text="Excluir" Arrow="true" Placement="Placement.Right">
                                                <MudIconButton @onclick="(()=> ExcluirBOEComplementado(BOEComplementado))" Icon="@Icons.Material.Filled.Delete" Color="Color.Error" />
                                            </MudTooltip>
                                        </MudTd>
                                    </RowTemplate>
                                </MudTable>
                            </MudPaper>
                        </MudItem>
                        <!-- Observações-->
                        <MudItem xs="12" sm="6">
                            <MudPaper Class="pa-2 mx-2" Elevation="0">
                                <MudTextField T="string" @bind-Value="@editarRegistro.ObservacaoRegistro"
                                              Label="Observações"
                                              Variant="Variant.Outlined"
                                              Lines="6" />
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>
            <!-- TabPages-->
            <MudItem xs="12">
                <MudTabs Elevation="3" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6" Class="sombra">
                    <!-- Fato-->
                    <MudTabPanel Text="Fato">
                        <MudText>
                            <MudPaper Class="pa-5 mx-2" Elevation="3">
                                <MudGrid>
                                    <!--Data-->
                                    <MudItem xs="12" sm="6" md="2">
                                        <MudDatePicker Label="Data do Fato"
                                                       DisableToolbar="true"
                                                       DateFormat="dd/MM/yyyy"
                                                       AllowKeyboardInput="true"
                                                       MaxDate="DateTime.Now"
                                                       @bind-Date="@editarRegistro.Fato.DataFato"
                                                       For="@(()=> editarRegistro.Fato.DataFato)"/>
                                    </MudItem>
                                    <!--Hora-->
                                    <MudItem xs="12" sm="6" md="2">
                                        <MudTimePicker Label="Hora do Fato"
                                                       @bind-Time="@editarRegistro.Fato.HoraFato" 
                                                       AllowKeyboardInput="true" 
                                                       AutoClose="true"/>
                                    </MudItem>
                                    <!--Turno-->
                                    <MudItem xs="12" sm="6" md="4">
                                        <MudSelect T="string" Label="Turno" Variant="Variant.Outlined" @bind-Value="@editarRegistro.Fato.TurnoFato">
                                            <MudSelectItem Value="@("MADRUGADA")" />
                                            <MudSelectItem Value="@("MANHA")" />
                                            <MudSelectItem Value="@("TARDE")" />
                                            <MudSelectItem Value="@("NOITE")" />
                                        </MudSelect>
                                    </MudItem>
                                    <!--Status Motivação-->
                                    <MudItem xs="12" sm="6" md="4">
                                        <MudField Label="Status Motivação" Variant="Variant.Outlined" InnerPadding="false">
                                            <MudRadioGroup @bind-SelectedOption="@editarRegistro.Fato.StatusMotivacaoFato">
                                                <MudRadio Option="@("PRELIMINAR")" Color="Color.Primary">Preliminar</MudRadio>
                                                <MudRadio Option="@("DEFINITIVA")" Color="Color.Primary">Definitiva</MudRadio>
                                            </MudRadioGroup>
                                        </MudField>
                                    </MudItem>
                                    <!--Natureza-->
                                    <MudItem xs="12" sm="6" md="6">
                                        <MudSelect T="string" Label="Natureza" Variant="Variant.Outlined" @bind-value="@editarRegistro.Fato.NaturezaBoe">
                                            <MudSelectItem Value="@("HOMICIDIO")" />
                                            <MudSelectItem Value="@("FEMINICIDIO")" />
                                            <MudSelectItem Value="@("ROUBO SEGUIDO DE MORTE (LATROCINIO)")" />
                                        </MudSelect>
                                    </MudItem>
                                    <!--Causa Jurídica-->
                                    <MudItem xs="12" sm="6" md="6">
                                        <MudSelect T="string" Label="Causa Jurídica" Variant="Variant.Outlined" @bind-Value="@editarRegistro.Fato.CausaJuridicaFato">
                                            <MudSelectItem Value="@("NAO INFORMADA")" />
                                            <MudSelectItem Value="@("ACIDENTE DE TRABALHO")" />
                                            <MudSelectItem Value="@("ATROPELAMENTO")" />
                                            <MudSelectItem Value="@("ACIDENTE OUTROS")" />
                                            <MudSelectItem Value="@("ACIDENTE DE TRANSITO")" />
                                            <MudSelectItem Value="@("SUICIDIO")" />
                                            <MudSelectItem Value="@("HOMICIDIO")" />
                                        </MudSelect>
                                    </MudItem>
                                    <!--Região-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudSelect T="string" Label="Região" Variant="Variant.Outlined" @bind-Value="@editarRegistro.Fato.RegiaoFato">
                                            <MudSelectItem Value="@("REGIAO METROPOLITANA")" />
                                            <MudSelectItem Value="@("ZONA DA MATA NORTE")" />
                                            <MudSelectItem Value="@("ZONA DA MATA SUL")" />
                                            <MudSelectItem Value="@("AGRESTE")" />
                                            <MudSelectItem Value="@("SERTAO")" />
                                        </MudSelect>
                                    </MudItem>
                                    <!--Município-->
                                    <MudItem xs="12" sm="6" md="4">
                                        <MudAutocomplete T="Municipio_Diretoria_AIS_BPM" Label="Município"
                                                         Variant="Variant.Outlined"
                                                         @bind-Value="@editarRegistro.Fato.MunicipioFato"
                                                         SearchFunc="@Municipios"
                                                         ToStringFunc="@(e => e == null ? null : $"{ e.Municipio }")"/>
                                        <ValidationMessage For="@(()=> editarRegistro.Fato.MunicipioFato)" />
                                    </MudItem>
                                    <!--Bairro-->
                                    <MudItem xs="12" sm="6" md="5">
                                        <MudTextField Label="Bairro"
                                                      Variant="Variant.Outlined"
                                                      @bind-Value="@editarRegistro.Fato.BairroFato"
                                                      For="@(()=> editarRegistro.Fato.BairroFato)"/>
                                    </MudItem>
                                    <!--Logradouro-->
                                    <MudItem xs="12" sm="6" md="6">
                                        <MudTextField @bind-Value="@editarRegistro.Fato.LogradouroFato"
                                                      Label="Logradouro"
                                                      Variant="Variant.Outlined" />
                                    </MudItem>
                                    <!--Numero do Logradouro-->
                                    <MudItem xs="12" sm="6" md="2">
                                        <MudTextField @bind-Value="@editarRegistro.Fato.NumeroLogradouroFato"
                                                      Label="Nº Logradouro"
                                                      Variant="Variant.Outlined" />
                                    </MudItem>
                                    <!--Complemento-->
                                    <MudItem xs="12" sm="12" md="4">
                                        <MudTextField @bind-Value="@editarRegistro.Fato.ComplementoFato"
                                                      Label="Complemento"
                                                      Variant="Variant.Outlined" />
                                    </MudItem>
                                    <!--Ponto de referência-->
                                    <MudItem xs="12" sm="6" md="4">
                                        <MudTextField @bind-Value="@editarRegistro.Fato.PontoReferenciaFato"
                                                      Label="Ponto de Referência"
                                                      Variant="Variant.Outlined" />
                                    </MudItem>
                                    <!--Localidade/Comunidade-->
                                    <MudItem xs="12" sm="6" md="8">
                                        <MudTextField @bind-Value="@editarRegistro.Fato.LocalidadeComunidadeFato"
                                                      Label="Localidade/Comunidade"
                                                      Variant="Variant.Outlined" />
                                    </MudItem>
                                    <!--Local do Fato-->
                                    <MudItem xs="12" sm="6" md="8">
                                        <MudAutocomplete T="string" Label="Local do Fato"
                                                         @bind-Value="@editarRegistro.Fato.LocalFato"
                                                         Variant="Variant.Outlined"
                                                         SearchFunc="@LocalFato" />
                                    </MudItem>
                                    <!--Zona-->
                                    <MudItem xs="12" sm="6" md="4">
                                        <MudField Label="Zona" Variant="Variant.Outlined" InnerPadding="false">
                                            <MudRadioGroup @bind-SelectedOption="@editarRegistro.Fato.ZonaFato">
                                                <MudRadio Option="@("URBANA")" Color="Color.Primary">Urbana</MudRadio>
                                                <MudRadio Option="@("RURAL")" Color="Color.Primary">Rural</MudRadio>
                                            </MudRadioGroup>
                                        </MudField>
                                    </MudItem>
                                    <!--Diretoria-->
                                    <MudItem xs="12" sm="6" md="4">
                                        @if (@editarRegistro.Fato.MunicipioFato is null)
                                        {
                                            <MudTextField @bind-Value="@editarRegistro.Fato.DiretoriaFato"
                                                          Label="Diretoria"
                                                          Variant="Variant.Outlined" />
                                        }
                                        else
                                        {
                                            <MudTextField Value="@editarRegistro.Fato.DiretoriaFato"
                                                          Label="Diretoria"
                                                          Variant="Variant.Outlined"
                                                          Text="@editarRegistro.Fato.MunicipioFato.Diretoria"/>
                                        }
                                    </MudItem>
                                    <!--AIS-->
                                    <MudItem xs="12" sm="6" md="4">
                                        @if (@editarRegistro.Fato.MunicipioFato is null)
                                        {
                                        <MudTextField @bind-Value="@editarRegistro.Fato.AisFato"
                                                      Label="AIS"
                                                      Variant="Variant.Outlined" />
                                        }
                                        else
                                        {
                                            <MudTextField Value="@editarRegistro.Fato.AisFato"
                                                          Label="AIS"
                                                          Variant="Variant.Outlined"
                                                          Text="@editarRegistro.Fato.MunicipioFato.AIS" />
                                        }
                                    </MudItem>
                                    <!--PMPE-->
                                    <MudItem xs="12" sm="6" md="4">
                                        @if (@editarRegistro.Fato.MunicipioFato is null)
                                        {
                                        <MudTextField @bind-Value="@editarRegistro.Fato.UnidadePMFato"
                                                      Label="Unidade PMPE"
                                                      Variant="Variant.Outlined" />
                                        }
                                        else
                                        {
                                            <MudTextField Value="@editarRegistro.Fato.UnidadePMFato"
                                                          Label="Unidade PMPE"
                                                          Variant="Variant.Outlined"
                                                          Text="@editarRegistro.Fato.MunicipioFato.BPM" />
                                        }
                                    </MudItem>
                                    <!--PCPE-->
                                    <MudItem xs="12" sm="6" md="12">
                                        <MudTextField @bind-Value="@editarRegistro.Fato.UnidadePCFato"
                                                      Label="Unidade PCPE"
                                                      Variant="Variant.Outlined" />
                                    </MudItem>
                                    <!--Latitude-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudTextField @bind-Value="@editarRegistro.Fato.LatitudeFato"
                                                      Label="Latitude"
                                                      Variant="Variant.Outlined" />
                                    </MudItem>
                                    <!--Longitude-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudTextField @bind-Value="@editarRegistro.Fato.LongitudeFato"
                                                      Label="Longitude"
                                                      Variant="Variant.Outlined" />
                                    </MudItem>
                                    <!--Fonte-->
                                    <MudItem xs="12" sm="6" md="6">
                                        <MudField Label="Fonte" Variant="Variant.Outlined" InnerPadding="false">
                                            <MudRadioGroup @bind-SelectedOption="@editarRegistro.Fato.FonteFato">
                                                <MudRadio Option="@("DO BOE")" Color="Color.Primary">Do BOE</MudRadio>
                                                <MudRadio Option="@("UNICAME")" Color="Color.Primary">UNICAME</MudRadio>
                                                <MudRadio Option="@("NO LOCAL")" Color="Color.Primary">No Local</MudRadio>
                                                <MudRadio Option="@("OUTRAS")" Color="Color.Primary">Outras</MudRadio>
                                            </MudRadioGroup>
                                        </MudField>
                                    </MudItem>
                                    <!--Histórico-->
                                    <MudItem xs="12" sm="12" md="12">
                                        <MudTextField Label="Histórico"
                                                      Variant="Variant.Outlined"
                                                      @bind-Value="@editarRegistro.Fato.HistoricoFato"
                                                      Lines="15" />
                                    </MudItem>
                                </MudGrid>
                            </MudPaper>
                        </MudText>
                    </MudTabPanel>
                    <!-- Envolvidos-->
                    <MudTabPanel Text="Envolvidos">
                        <MudText>
                            <MudGrid>
                                <MudItem xs="12">
                                    <MudTable Items="@listaEnvolvidos" Dense="true" Hover="true" Striped="true">
                                        <ToolBarContent>
                                            <MudText Typo="Typo.subtitle2">Lista de Envolvidos</MudText>
                                            <MudSpacer />
                                            <MudTooltip Text="Adicionar" Arrow="true" Placement="Placement.Left">
                                                <MudFab @onclick="AdicionarEnvolvido" Color="Color.Primary" Icon="@Icons.Material.Filled.Add" Size="Size.Small" IconSize="Size.Medium" Class="ma-2" />
                                            </MudTooltip>
                                        </ToolBarContent>
                                        <HeaderContent>
                                            <MudTh>Sequencial</MudTh>
                                            <MudTh>Tipo</MudTh>
                                            <MudTh>Nome</MudTh>
                                            <MudTh>Data de Nascimento</MudTh>
                                            <MudTh>Ações</MudTh>
                                        </HeaderContent>
                                        <RowTemplate Context="Envolvido">
                                            <MudTd DataLabel="Sequencial">@Envolvido.SequencialEnvolvido</MudTd>
                                            <MudTd DataLabel="Tipo">@Envolvido.TipoEnvolvido</MudTd>
                                            <MudTd DataLabel="Nome">@Envolvido.NomeEnvolvido</MudTd>
                                            <MudTd DataLabel="Data de Nascimento">@Envolvido.DataNascimento.Value.ToString("d")</MudTd>
                                            <MudTd DataLabel="Ações">
                                                <MudTooltip Text="Alterar" Arrow="true" Placement="Placement.Left">
                                                    <MudIconButton OnClick="(()=> EditarEnvolvido(Envolvido))" Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" aria-label="editar"></MudIconButton>
                                                </MudTooltip>
                                                <MudTooltip Text="Excluir" Arrow="true" Placement="Placement.Right">
                                                    <MudIconButton OnClick="(()=> ExcluirEnvolvido(Envolvido))" Icon="@Icons.Material.Filled.Delete" Color="Color.Error" aria-label="delete"></MudIconButton>
                                                </MudTooltip>
                                            </MudTd>
                                        </RowTemplate>
                                    </MudTable>
                                </MudItem>
                            </MudGrid>
                        </MudText>
                    </MudTabPanel>
                    <!-- Inquérito-->
                    <MudTabPanel Text="Inquérito">
                        <MudText>
                            <MudPaper Class="pa-5 mx-2" Elevation="3">
                                <MudGrid>
                                    <!--Tipo de Instauração-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudSelect T="string" Label="Tipo de Instauração" Variant="Variant.Outlined" @bind-Value="@editarRegistro.Inquerito.TipoInstauracao">
                                            <MudSelectItem Value="@("APFD")" />
                                            <MudSelectItem Value="@("AAFAI")" />
                                            <MudSelectItem Value="@("PEM")" />
                                            <MudSelectItem Value="@("REQUISICAO DO MP")" />
                                            <MudSelectItem Value="@("PORTARIA")" />
                                        </MudSelect>
                                    </MudItem>
                                    <!--Número do Inquérito Policial-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudTextField @bind-Value="@editarRegistro.Inquerito.NumeroIP"
                                                      Label="Número do Inquérito Policial"
                                                      Variant="Variant.Outlined"
                                                      Adornment="Adornment.End"
                                                      Immediate="true" />
                                    </MudItem>
                                    <!--Data da Instauração-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudPaper Class="pa-2 mx-2" Elevation="0">
                                            <MudDatePicker Label="Data Instauração"
                                                           DisableToolbar="true"
                                                           DateFormat="dd/MM/yyyy"
                                                           AllowKeyboardInput="true"
                                                           MaxDate="DateTime.Now"
                                                           @bind-Date="@editarRegistro.Inquerito.DataInstaraucao" />

                                        </MudPaper>
                                    </MudItem>
                                    <!--Situação Atual-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudSelect T="string" Label="Situação Atual" Variant="Variant.Outlined" @bind-Value="@editarRegistro.Inquerito.SituacaoIP">
                                            <MudSelectItem Value="@("Em Investigação")" />
                                            <MudSelectItem Value="@("Sem Investigação")" />
                                            <MudSelectItem Value="@("Conclusão com Autoria")" />
                                            <MudSelectItem Value="@("Conclusão sem Autoria")" />
                                        </MudSelect>
                                    </MudItem>
                                    <!-- Números -->
                                    <MudItem xs="12" sm="6" md="6">
                                        <MudField Label="Número de: " Variant="Variant.Outlined">
                                            <MudGrid>
                                                <MudItem xs="12" sm="6" md="12" Style="margin: 8px 20px">
                                                    <MudGrid>
                                                        <label style="margin: 12px 5px">Ouvidas de Testemunhas</label>
                                                        <MudNumericField @bind-Value="@editarRegistro.Inquerito.NumeroOuvida"
                                                                         Variant="Variant.Outlined"
                                                                         Margin="Margin.Dense"
                                                                         Style="width: 50%; margin-left: 50%;" 
                                                                         Min="0"
                                                                         Max="10"/>
                                                    </MudGrid>
                                                </MudItem>
                                                <MudItem xs="12" sm="6" md="12" Style="margin: 8px 20px">
                                                    <MudGrid>
                                                        <label style="margin: 12px 5px">Declarações de Familiares </label>
                                                        <MudNumericField @bind-Value="@editarRegistro.Inquerito.NumeroDeclaracao"
                                                                         Variant="Variant.Outlined"
                                                                         Margin="Margin.Dense"
                                                                         Style="width: 50%; margin-left: 49%; " 
                                                                         Min="0"
                                                                         Max="10"/>
                                                    </MudGrid>
                                                </MudItem>
                                                <MudItem xs="12" sm="6" md="12" Style="margin: 8px 20px">
                                                    <MudGrid>
                                                        <label style="margin: 12px 5px">Qual.Interrogatório/Susp.</label>
                                                        <MudNumericField @bind-Value="@editarRegistro.Inquerito.NumeroQual"
                                                                         Variant="Variant.Outlined"
                                                                         Margin="Margin.Dense"
                                                                         Style="width: 50%; margin-left: 50%;" 
                                                                         Min="0"
                                                                         Max="10"/>
                                                    </MudGrid>
                                                </MudItem>
                                            </MudGrid>
                                        </MudField>
                                    </MudItem>
                                    <!-- Representação-->
                                    <MudItem xs="12" sm="6" md="6">
                                        <MudField Label="Representação" Variant="Variant.Outlined">
                                            <MudGrid>
                                                <MudItem xs="12" sm="6" md="12">
                                                    <MudSelect T="string" Label="Situação Atual" Variant="Variant.Outlined" @bind-Value="@editarRegistro.Inquerito.TipoRepresentacao">
                                                        <MudSelectItem Value="@("PRISAO PREVENTIVA")" />
                                                        <MudSelectItem Value="@("PRISAO TEMPORARIA")" />
                                                        <MudSelectItem Value="@("BUSCA E APREENSAO ADOLESCENTE")" />
                                                        <MudSelectItem Value="@("BUSCA E APREENSAO DOMICILIAR")" />
                                                        <MudSelectItem Value="@("QUEBRA DE SIGILO TELEFONICO")" />
                                                        <MudSelectItem Value="@("QUEBRA DE SIGILO TELEMATICO")" />
                                                        <MudSelectItem Value="@("QUEBRA DE SIGILO BANCARIO")" />
                                                        <MudSelectItem Value="@("QUEBRA DE SIGILO FISCAL")" />
                                                        <MudSelectItem Value="@("INTERCEPTACAO TELEFONICA")" />
                                                        <MudSelectItem Value="@("OUTROS")" />
                                                    </MudSelect>
                                                </MudItem>
                                                <!--Data Representação-->
                                                <MudItem xs="12" sm="6" md="6">
                                                    <MudPaper Class="pa-2 mx-2" Elevation="0">
                                                        <MudDatePicker Label="Data Representação"
                                                                       DisableToolbar="true"
                                                                       DateFormat="dd/MM/yyyy"
                                                                       AllowKeyboardInput="true"
                                                                       MaxDate="DateTime.Now"
                                                                       @bind-Date="@editarRegistro.Inquerito.DataRepresentacao" />

                                                    </MudPaper>
                                                </MudItem>
                                                <!--Numero do Oficio-->
                                                <MudItem xs="12" sm="6" md="6">
                                                    <MudTextField @bind-Value="@editarRegistro.Inquerito.NumOfRemessa"
                                                                  Label="Número do Ofício"
                                                                  Variant="Variant.Outlined"
                                                                  Adornment="Adornment.End"
                                                                  Immediate="true" />
                                                </MudItem>
                                            </MudGrid>
                                        </MudField>
                                    </MudItem>
                                    <!--Expedição de Mandado-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudField Label="Expediu Mandado?" Variant="Variant.Outlined" InnerPadding="false">
                                            <MudRadioGroup @bind-SelectedOption="@editarRegistro.Inquerito.ExpedicaoMandado">
                                                <MudRadio Option="@("SIM")" Color="Color.Primary">Sim</MudRadio>
                                                <MudRadio Option="@("NAO")" Color="Color.Primary">Não</MudRadio>
                                            </MudRadioGroup>
                                        </MudField>
                                    </MudItem>
                                    <!--Houve Cumprimento-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudField Label="Houve Cumprimento?" Variant="Variant.Outlined" InnerPadding="false">
                                            <MudRadioGroup @bind-SelectedOption="@editarRegistro.Inquerito.CumprimentoMandado">
                                                <MudRadio Option="@("SIM")" Color="Color.Primary">Sim</MudRadio>
                                                <MudRadio Option="@("NAO")" Color="Color.Primary">Não</MudRadio>
                                            </MudRadioGroup>
                                        </MudField>
                                    </MudItem>
                                    <!--Unidade Policial Responsável-->
                                    <MudItem xs="12" sm="6" md="6">
                                        <MudTextField @bind-Value="@editarRegistro.Inquerito.UnidadePC"
                                                      Label="Unidade Policial Responsável"
                                                      Variant="Variant.Outlined"
                                                      Adornment="Adornment.End"
                                                      Immediate="true" />
                                    </MudItem>
                                    <!--Data de Conclusão-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudPaper Class="pa-2 mx-2" Elevation="0">
                                            <MudDatePicker Label="Data Conclusão"
                                                           DisableToolbar="true"
                                                           DateFormat="dd/MM/yyyy"
                                                           AllowKeyboardInput="true"
                                                           MaxDate="DateTime.Now"
                                                           @bind-Date="@editarRegistro.Inquerito.DataConclusao" />

                                        </MudPaper>
                                    </MudItem>
                                    <!--Nº Of/CI Remessa-->
                                    <MudItem xs="12" sm="6" md="6">
                                        <MudTextField @bind-Value="@editarRegistro.Inquerito.NumOfRemessa"
                                                      Label="Nº Of./Ci Remessa"
                                                      Variant="Variant.Outlined"
                                                      Adornment="Adornment.End"
                                                      Immediate="true" />
                                    </MudItem>
                                    <!--Destino-->
                                    <MudItem xs="12" sm="6" md="3">
                                        <MudSelect T="string" Label="Destino" Variant="Variant.Outlined" @bind-Value="@editarRegistro.Inquerito.Destino">
                                            <MudSelectItem Value="@("MINISTERIO PUBLICO")" />
                                            <MudSelectItem Value="@("COORDPPOL")" />
                                            <MudSelectItem Value="@("PODER JUDICIARIO")" />
                                            <MudSelectItem Value="@("OUTROS")" />
                                        </MudSelect>
                                    </MudItem>
                                    <!--Autoridade Policial Responsável pela Investigação-->
                                    <MudItem xs="12" sm="6" md="8">
                                        <MudTextField T="string" @bind-Value="@editarRegistro.Inquerito.AutoridadeResponsavel"
                                                      Label="Autoridade Policial Responsável pela Investigação"
                                                      Variant="Variant.Outlined"
                                                      Adornment="Adornment.End"
                                                      Immediate="true" />
                                    </MudItem>
                                    <!--Matrícula-->
                                    <MudItem xs="12" sm="6" md="4">
                                        <MudTextField @bind-Value="@editarRegistro.Inquerito.MatriculaAutoridadeResponsavel"
                                                      Label="Matrícula"
                                                      Variant="Variant.Outlined"
                                                      Adornment="Adornment.End"
                                                      Immediate="true" />
                                    </MudItem>
                                </MudGrid>
                            </MudPaper>
                        </MudText>
                    </MudTabPanel>
                    <!--Arquivos-->
                    <MudTabPanel Text="Arquivos">
                        <MudText>
                            <MudGrid>
                                <MudItem xs="12">
                                    <InputFile id="upload" OnChange="UploadArquivos" multiple hidden/>
                                    <MudTable Items="@listaArquivos" Dense="true" Hover="true" Striped="true" Height="400px">
                                        <ToolBarContent>
                                            <MudText Typo="Typo.subtitle2">Lista de Arquivos</MudText>
                                            <MudSpacer />
                                            <MudTooltip Text="Adicionar" Arrow="true" Placement="Placement.Left">
                                                <MudIconButton for="upload" HtmlTag="label" Color="Color.Primary" Icon="@Icons.Material.Filled.UploadFile" Size="Size.Large" Class="ma-2" />
                                            </MudTooltip>
                                            <MudTooltip Text="Limpar Tudo" Arrow="true" Placement="Placement.Right">
                                                <MudIconButton OnClick="@listaArquivos.Clear" Disabled="@(!listaArquivos.Any())" Icon="@Icons.Filled.ClearAll" Color="Color.Error" Size="Size.Large" Class="ma-2" />
                                            </MudTooltip>
                                        </ToolBarContent>
                                        <HeaderContent>
                                            <MudTh>Nome do Arquivo</MudTh>
                                            <MudTh>Tipo</MudTh>
                                            <MudTh>Adicionado em</MudTh>
                                            <MudTh>Ações</MudTh>
                                        </HeaderContent>
                                        <RowTemplate Context="listaArquivos">
                                            <MudTd DataLabel="Nome do Arquivo">@listaArquivos.NomeArquivo</MudTd>
                                            <MudTd DataLabel="Tipo">
                                                @switch(@listaArquivos.TipoArquivo)
                                                {
                                                    case "pdf":
                                                        <MudChip Icon="@Icons.Custom.FileFormats.FilePdf" Class="chipTransparente" IconColor="Color.Error" IconSize="Size.Large"/>
                                                        break;
                                                    case "docx" or "doc":
                                                        <MudChip Icon="@Icons.Custom.FileFormats.FileWord" Class="chipTransparente" IconColor="Color.Info" Size="Size.Large"/>
                                                        break;
                                                    case "xlsx" or "xls":
                                                        <MudChip Icon="@Icons.Custom.FileFormats.FileExcel" Class="chipTransparente" IconColor="Color.Tertiary" Size="Size.Large"/>
                                                        break;
                                                    case "png" or "jpg" or "jpeg":
                                                        <MudChip Icon="@Icons.Custom.FileFormats.FileImage" Class="chipTransparente" IconColor="Color.Primary" Size="Size.Large"/>
                                                        break;
                                                    default:
                                                        <MudChip Icon="@Icons.Custom.FileFormats.FileDocument" Class="chipTransparente" IconColor="Color.Default" Size="Size.Large"/>
                                                        break;
                                                }
                                            </MudTd>
                                            <MudTd DataLabel="Adicionado em">@listaArquivos.CriacaoArquivo.Value.ToString("g")</MudTd>
                                            <MudTd DataLabel="Ações">
                                                <MudTooltip Text="Baixar" Arrow="true" Placement="Placement.Top">
                                                    <MudIconButton @onclick="(()=> BaixarArquivo(listaArquivos))" Icon="@Icons.Filled.FileDownload" Color="Color.Primary" />
                                                </MudTooltip>
                                                <MudTooltip Text="Excluir" Arrow="true" Placement="Placement.Right">
                                                    <MudIconButton @onclick="(()=> ExcluirArquivo(listaArquivos))" Icon="@Icons.Material.Filled.Delete" Color="Color.Error" />
                                                </MudTooltip>
                                            </MudTd>
                                        </RowTemplate>
                                    </MudTable>
                                </MudItem>
                            </MudGrid>
                        </MudText>
                    </MudTabPanel>
                </MudTabs>
            </MudItem>
            <!--Botão Salvar-->
            <MudItem xs="6">
                <MudButton OnClick="Home" Variant="Variant.Filled" Color="Color.Secondary" FullWidth="true">Cancelar</MudButton>
            </MudItem>
            <MudItem xs="6">
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" FullWidth="true">Atualizar</MudButton>
            </MudItem>
        </MudGrid>
    </MudContainer>
</EditForm>


@code {

    [CascadingParameter] public IModalService Modal { get; set; }

    public List<NovoEnvolvido> listaEnvolvidos { get; set; } = new List<NovoEnvolvido> { };

    public List<NovoBoe> listaBOEComplementados { get; set; } = new List<NovoBoe> { };

    public List<NovoArquivo> listaArquivos { get; set; } = new List<NovoArquivo> { };

    public EditarRegistro editarRegistro = new EditarRegistro
    {
        Fato = new AlterarFato(),
        Envolvidos = new List<NovoEnvolvido>(),
        Inquerito = new NovoInquerito(),
        BoeComplementados = new List<NovoBoe>(),
        Arquivos = new List<NovoArquivo>()
    };

    [Parameter] public int Id { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        await BuscaRegistro();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JS.InvokeVoidAsync("masks");
        }
    }

    private async Task<ExibirUsuario> ObterUsuarioLogadoNoSistema()
    {
        return await localStorage.GetItemAsync<ExibirUsuario>("usuario");
    }

    protected async Task BuscaRegistro()
    {
        var usuarioLogado = await ObterUsuarioLogadoNoSistema();

        editarRegistro = await ObterRegistroPeloId(usuarioLogado);

        AdicionaArquivoBOEComplementadoEnvolvidoNasListas(editarRegistro);
    }

    private async Task<EditarRegistro> ObterRegistroPeloId(ExibirUsuario usuarioLogado)
    {
        var request = new HttpRequestMessage(HttpMethod.Get, "https://localhost:44343/api/v1/Registro/buscar-registro/" + Id);
        request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", usuarioLogado.Token);
        var response = await httpClient.SendAsync(request);

        editarRegistro = JsonSerializer.Deserialize<EditarRegistro>
        (
            await response.Content.ReadAsStringAsync(),
            new JsonSerializerOptions { PropertyNameCaseInsensitive = true, Converters = { new TimeSpanJsonConverter() } }
        );

        return editarRegistro;
    }

    void AdicionaArquivoBOEComplementadoEnvolvidoNasListas(EditarRegistro editarRegistro)
    {
        listaArquivos = editarRegistro.Arquivos;
        listaBOEComplementados = editarRegistro.BoeComplementados;
        listaEnvolvidos = editarRegistro.Envolvidos;
    }

    void AdicionarOIdEAsListasNoRegistro()
    {
        editarRegistro.Id = Id;
        editarRegistro.Envolvidos = listaEnvolvidos;
        editarRegistro.BoeComplementados = listaBOEComplementados;
        editarRegistro.Arquivos = listaArquivos;
    }

    protected async Task EditarRegistro()
    {
        AdicionarOIdEAsListasNoRegistro();

        var usuarioLogado = await ObterUsuarioLogadoNoSistema();
        editarRegistro.UsuarioRegistro = usuarioLogado.Nome;

        var request = new HttpRequestMessage(HttpMethod.Put, "https://localhost:44343/api/v1/Registro/alterar-registro/" + Id);
        request.Content = new StringContent(JsonSerializer.Serialize(editarRegistro, new JsonSerializerOptions { Converters = { new TimeSpanJsonConverter() } }), Encoding.UTF8, "application/json");
        request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", usuarioLogado.Token);
        var response = await httpClient.SendAsync(request);

        if (response.IsSuccessStatusCode)
        {
            snackbar.Add("Registro Salvo!", Severity.Success);
            navigationManager.NavigateTo("/");
        }
        else
        {
            snackbar.Add("O Registro não foi salvo!", Severity.Error);
        }
    }

    void Home() => navigationManager.NavigateTo("/");

    //Envolvido
    async Task AdicionarEnvolvido()
    {
        var formModal = Modal.Show<Envolvido>("Adicionar Envolvido");
        var result = await formModal.Result;

        if (result.Cancelled)
        {
            snackbar.Add("Não foi adicionado nenhum Envolvido!", Severity.Info);
        }
        else
        {
            var novoEnvolvido = (NovoEnvolvido)(Convert.ChangeType(result.Data, typeof(NovoEnvolvido)));
            AdicionarNumeroSequencial();
            novoEnvolvido.SequencialEnvolvido = sequencial;
            listaEnvolvidos.Add(novoEnvolvido);
            snackbar.Add("Envolvido adicionado!", Severity.Success);
            StateHasChanged();
        }
    }
    int sequencial;
    void AdicionarNumeroSequencial()
    {
        if(listaEnvolvidos.Count() == 0)
        {
            sequencial = 1;
        }
        else
        {
            var qtd =  listaEnvolvidos.Count();
            qtd++;
            sequencial = qtd; 
        }
    }

    async Task EditarEnvolvido(NovoEnvolvido novoEnvolvido)
    {
        var parameters = new ModalParameters();
        parameters.Add("novoEnvolvido", novoEnvolvido);

        var formModal = Modal.Show<Envolvido>("Alterar Envolvido", parameters);
        var result = await formModal.Result;

        if (result.Cancelled)
        {
            snackbar.Add("Envolvido não foi alterado!", Severity.Info);
        }
        else
        {
            StateHasChanged();
            snackbar.Add("Envolvido alterado!", Severity.Success);
        }
    }

    void ExcluirEnvolvido(NovoEnvolvido envolvido)
    {
        listaEnvolvidos.Remove(envolvido);
        snackbar.Add("Envolvido removido!", Severity.Warning);
    }

    //BOEComplementado
    async Task AdicionarBOEComplementado()
    {
        var formModal = Modal.Show<BOEComplementado>("Adicionar BOE Complementado");
        var result = await formModal.Result;

        if (result.Cancelled)
        {
            snackbar.Add("Não foi adicionado nenhum BOE Complementado!", Severity.Info);
        }
        else
        {
            var boeComplementado = (NovoBoe)(Convert.ChangeType(result.Data, typeof(NovoBoe)));

            boeComplementado.RegistroId = Id;

            listaBOEComplementados.Add(boeComplementado);

            StateHasChanged();

            snackbar.Add("BOE Complementado adicionado!", Severity.Success);
        }
    }

    async Task EditarBOEComplementado(NovoBoe novoBOEComplementado)
    {
        var parameters = new ModalParameters();
        parameters.Add("novoBOEComplementado", novoBOEComplementado);

        var formModal = Modal.Show<BOEComplementado>("Alterar BOE Complementado", parameters);
        var result = await formModal.Result;

        if (result.Cancelled)
        {
            snackbar.Add("BOE Complementado não foi Alterado!", Severity.Info);
        }
        else
        {
            StateHasChanged();
            snackbar.Add("BOE Complementado alterado!", Severity.Success);
        }
    }

    void ExcluirBOEComplementado(NovoBoe boe)
    {
        listaBOEComplementados.Remove(boe);
        snackbar.Add("BOE Complementado removido!", Severity.Warning);
    }

    //Motivação Crime
    private string[] motivacaoCrime =
    {
        "A DEFINIR", "ACERTO DE CONTAS", "BALA PERDIDA", "BRIGA (INTRA)FAMILIAR CONTRA MULHER",
        "BRIGA (INTRA)FAMILIAR", "CONFLITO AGRARIO", "CONFLITO INTIMO-AFETIVO CONTRA HOMEM",
        "CONFLITO INTIMO-AFETIVO CONTRA MULHER", "CRIME ORGANIZADO", "CRIME POR ENCOMENDA",
        "DESCONHECIDO", "DESENTENDIMENTO ENTRE VIZINHOS", "DESENTENDIMENTO GRUPO CRIMINOSO - DROGAS ILICITAS",
        "DESENTENDIMENTO GRUPO CRIMINOSO - EXCETO DROGAS", "DISCUSSAO (OUTRAS CIRCUNSTANCIAS)",
        "DISCUSSÃO DE TRANSITO", "DISCUSSAO POR EMBRIAGUEZ", "DISPUTA DE GANGUES",
        "DISPUTA POR TERRITORIO OU MERCADO - DROGAS ILICITA", "EMBRIAGUEZ",
        "ENFRENTAMENTO COM AGENTE DE SEGURANÇA PUBLICA", "ENFRENTAMENTO COM CRIMINOSO/S", "ENGANO",
        "ENTORPECENTES/DROGAS", "ENVOLVIMENTO COM CORRUPCAO/ TRAFICO DE INFLUENCIAS", "ESPORTIVA",
        "EXTORSAO", "EXTORSAO MEDIANTE SEQUESTRO", "FEMINICIDIO", "GRUPO DE EXTERMINIO", "HOMOFOBIA",
        "INTERESSE FINANCEIRO", "INTIMO AFETIVO", "INTIMO AFETIVO CONTRA PESSOA DO SEXO MASCULINO",
        "INTRAFAMILIAR", "INTRAFAMILIAR CONTRA PESSOA DO SEXO MASCULINO", "LATROCINIO",
        "LEGITIMA DEFESA", "LUCRO", "NAO INFORMADO", "OUTRAS EXCLUDENTES DE ILICITUDE", "OUTROS",
        "PISTOLAGEM", "POLITICO", "QUEIMA DE ARQUIVO/ELIMINACAO TESTEMUNHA/COMPARSA", "RACISMO",
        "RACISMO/XENOFOBIA", "REACAO DE UM CIDADAO A UM DELITO", "RELIGIOSO", "RETALIACAO POR DIVIDAS - DROGAS ILICITAS",
        "RIXA", "RIXA/GALERA", "SACRIFICIO RITUAL", "SEXUAL (LIBIDINOSA)", "SEXUAL CONTRA PESSOA DO SEXO FEMININO",
        "SEXUAL OU MENOSPREZO AO CORPO", "VINGANCA PESSOAL", "VITIMIZACAO POLICIAL (EM SERVICO)",
        "VITIMIZACAO POLICIAL (FORA DE SERVICO)", "XENOFOBIA"
    };

    private async Task<IEnumerable<string>> MotivacaoCrime(string value)
    {
        await Task.Delay(3);
        if (string.IsNullOrEmpty(value))
            return motivacaoCrime;
        return motivacaoCrime.Where(x => x.Contains(value, StringComparison.InvariantCultureIgnoreCase));
    }

    //Município
    private async Task<IEnumerable<Municipio_Diretoria_AIS_BPM>> Municipios(string value)
    {
        var usuarioLogado = await ObterUsuarioLogadoNoSistema();

        var request = new HttpRequestMessage(HttpMethod.Get, "https://localhost:44343/api/v1/Municipio_Diretoria_AIS_BPM");
        request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", usuarioLogado.Token);
        var response = await httpClient.SendAsync(request);

        var municipios = JsonSerializer.Deserialize<List<Municipio_Diretoria_AIS_BPM>>
        (
            await response.Content.ReadAsStringAsync(),
            new JsonSerializerOptions { PropertyNameCaseInsensitive = true }
        );

        if (string.IsNullOrEmpty(value))
            return municipios;
        return municipios.Where(x => x.Municipio.Contains(value, StringComparison.InvariantCultureIgnoreCase));
    }

    private string[] localFato =
    {
        "ACADEMIA", "ACUDE", "AERONAVE", "AEROPORTO",
        "AGENCIA DOS CORREIOS", "APARTAMENTO", "AREA MILITAR FEDERAL", "ASILO",
        "ASSENTAMENTO", "ASSOCIACAO", "AVIAO", "BANCA DE REVISTA/FITEIRO",
        "BANCO (AGENCIA BANCARIA)", "BAR", "BILHETERIA", "CAIXA ELETRONICO",
        "CALCADA",  "CALCADAO", "CAMPO DE FUTEBOL", "CANAVIAL", "CARRO-FORTE",
        "CASA DE ACOLHIMENTO (MENOR)",  "CASA DE CACA/PESCA",   "CASA DE SHOW",
        "CASA LOTERICA",    "CASA NOTURNA(BOATE/DANCETERIA)",   "CEMITERIO",
        "CENTRAL DE ABASTECIMENTO", "CENTRO DE CONVENCOES", "CHACARA",
        "CICLOVIA/CICLO FAIXA", "CINEMA", "CLUBE",    "COLONIA",  "COMPOSICAO FERREA",
        "CONDOMINIO DE CASAS",  "CONSULADO", "CONSULTORIO",  "CORREGO",  "CRECHE",
        "CRUZAMENTO",   "DELEGACIA DE POLICIA", "EDIFICIO / CONDOMINIO COMERCIAL",
        "EDIFICIO / CONDOMINIO MISTO",  "EDIFICIO/CONDOMINIO RESIDENCIAL",
        "EM FRENTE DA RESIDENCIA",  "EMBARCACAO",   "EMPRESA",  "ENGENHO",
        "ESCRITORIO",   "ESTABELECIMENTO COMERCIAL",    "ESTABELECIMENTO DE ENSINO SUPERIOR",
        "ESTABELECIMENTO ENSINO PARTICULAR-1º E 2º GRAU",
        "ESTABELECIMENTO ENSINO PUBLICO ESTADUAL-1º E 2º GRAU",
        "ESTABELECIMENTO ENSINO PUBLICO MUNICIPAL-1º E 2º GRAU",    "ESTABELECIMENTO PENAL",
        "ESTACAO DE TREM / METRO",  "ESTACIONAMENTO",   "ESTADIO",
        "ESTAÇÃO DE B.R.T", "FARMACIA / DROGARIA",  "FAVELA",   "FAZENDA",  "FEIRA LIVRE",
        "GALPAO",   "GARAGEM",  "GINASIO",  "HOSPITAL", "HOTEL",    "IGREJA / TEMPLOS", "INDUSTRIA",
        "INSTITUICOES FINANCEIRAS", "INTERNET", "JARDIM ZOOLÓGICO", "JOALHARIA",
        "LAGOA",    "LANCHONETE",   "LIVRARIA", "LIXAO",    "LOCAL ERMO / TERRENO BALDIO",
        "LOCAL INDETERMINADO / DESCONHECIDO",   "LOMBADA",  "LOTACAO",  "MANGUEZAL",
        "OUTROS ESTABELECIMENTOS DE DIVERSAO",  "OUTROS ESTABELECIMENTOS DE SAUDE",
        "PADARIA",  "PARADA DE ONIBUS", "PARQUE DE DIVERSAO",   "PARQUE DE EXPOSICAO",
        "PARQUE PUBLICO",   "PIZZARIA", "POCO", "PONTE",    "PORTO",    "POSTO DE GASOLINA",
        "POUSADA",  "PRACA PUBLICA",    "PRAIA",    "PREDIO PUBLICO",   "PROPRIEDADE RURAL",
        "QUADRA ESPORTIVA", "QUARTEL",  "REPARTICOES PUBLICAS", "RESIDENCIA ( APARTAMENTO )",
        "RESIDENCIA ( TERREA )",    "RESTAURANTE",  "RIO",  "RODOVIA",  "RODOVIA ESTADUAL",
        "VIA PUBLICA"
    };


    //Local Fato
    private async Task<IEnumerable<string>> LocalFato(string value)
    {
        await Task.Delay(3);
        if (string.IsNullOrEmpty(value))
            return localFato;
        return localFato.Where(x => x.Contains(value, StringComparison.InvariantCultureIgnoreCase));
    }

    //Arquivos
    private async Task UploadArquivos(InputFileChangeEventArgs e)
    {
        foreach (var arquivo in e.GetMultipleFiles())
        {
            var fileContent = arquivo.OpenReadStream(maxAllowedSize: 2097152);

            using var target = new MemoryStream();
            await fileContent.CopyToAsync(target);
            var dadosArquivo = target.ToArray();

            listaArquivos.Add( new NovoArquivo()
            {
                RegistroId = Id,
                NomeArquivo = arquivo.Name,
                TipoArquivo = (arquivo.Name).Split(".").Last(),
                CriacaoArquivo = DateTime.Now,
                DadosArquivo = dadosArquivo
            });
        }
    }

    private async Task BaixarArquivo(NovoArquivo arquivo)
    {
        var fileStream = new MemoryStream(arquivo.DadosArquivo);

        var fileName = arquivo.NomeArquivo;

        using var streamRef = new DotNetStreamReference(stream: fileStream);

        await JS.InvokeVoidAsync("downloadFileFromStream", fileName, streamRef);
    }

    void ExcluirArquivo(NovoArquivo arquivo) => listaArquivos.Remove(arquivo);
}

<style>
    .sombra {
        box-shadow: 3px 3px 3px 3px #aaaaaa;
    }

    .tabelaBOEcomplementado {
        height: 160px;
        overflow: scroll;
    }

    .blazored-modal-header{
        color: black;
    }

    .status {
        margin-left: 10px;
        margin-right: 0px;
        margin-bottom: 0px;
    }

    .editForm{
        padding-bottom: 440px;
    }
</style>